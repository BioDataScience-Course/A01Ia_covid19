---
title: "Suivi de la vaccination contre le COVID 19 en Belgique"
author: "___"
date: "`r lubridate::today()`"
output:
  html_document: 
    code_folding: hide 
    theme: journal
    highlight: tango
---

<!--# Ceci est un commentaire. Il n'apparait pas dans votre rapport final. Observez la structure balisée par --- ci-dessus. C'est une zone particulière qui renseigne les informations de base du document telles que le titre, l'auteur, la date ou encore le format de sortie du document. Cette zone s'appelle un entête YAML. -->

<!--% Ceci est une consigne. Remplacez author: "___" par votre nom. ex: author: "Engels Guyliann". Attention, l'entête YAML est très sensible aux espaces et aux guillemets..-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
# Chargement de packages utiles ----
SciViews::R(lang = "fr")
library(lubridate)
# mise à jour des données en local, si nécessaire ----
#source(here::here("R", "import_data.R"))
# importation des données en local ----
vaccine <- read(here::here("data", "be_vaccines_covid.rds"))
last_update <- paste0("Mis à jour le " , attr(vaccine, "local_save"))
```

<!--# Observez les instructions ci-dessus, le code est placé dans une zone particulière que l'on nomme un chunk. -->

# Introduction

Afin de lutter contre le COVID 19, le gouvernement belge réalise une campagne de vaccination qui a débuté le `r min(vaccine$date)`.

![Photo by <a href="https://unsplash.com/@cdc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">CDC</a> on <a href="https://unsplash.com/s/photos/vaccination?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>](../figures/covid.jpg){width="50%"}

*Les analyses proposées ci-dessous utilisent les données datant du `r attr(vaccine, "local_save")`.*

# Analyses

En Belgique, `r fsum(vaccine$count)` doses de vaccin ont été administrées. Deux vagues de vaccination sont observées via le nombre de vaccinations par semaine au cours du temps. Une troisième vague semble débuter en septembre 2022.

```{r}
vaccine %>.%
  smutate(., week = floor_date(date,"week", week_start = 1)) %>.%
  sgroup_by(., week) |> ssummarise(tot = fsum(count)) %>.%
  chart(data = ., tot ~ week) +
  geom_point() +
  geom_line() +
  xlab("Temps")
```

```{r}
vaccine %>.%
  sgroup_by(., brand, dose) |> ssummarise(
    nb = fsum(count))  |> sarrange(desc(nb)) ->
  nb_brand_dose

nb_brand_dose %>.%
  sgroup_by(., brand) |> ssummarise(
    nb = fsum(nb))  |> sarrange(desc(nb)) ->
  nb_brand
```

Le tableau ci-dessous indique la répartition des vaccins administrés. Le vaccin le plus administré est le `r ffirst(nb_brand$brand)`.

<!--# Dans le paragraphe ci-dessus, vous pouvez observer que du code R a été intégré au sein du texte. Il s'agit d'une forme de chunk raccourci qui est prévu pour être intégré dans des paragraphes. Cette technique est très utile pour ajouter des éléments contextuels aux données. -->

```{r}
knitr::kable(nb_brand, 
  col.names = c("Vaccin", "Nombre de doses"),
  caption = paste("Nombre de doses de vaccins administrés en Belgique au", attr(vaccine, "local_save")))
```

La campagne de vaccination a mené à l'administration de plusieurs doses des différents vaccins.

```{r}
nb_brand_dose %>.% 
  spivot_wider(nb_brand_dose, names_from = "dose", values_from = "nb") %>.%
  replace_NA(., value = 0) |> knitr::kable(
    col.names = c("Vaccin", "A",	"B",	"C",	"E",	"E2",	"E3"),
    caption = paste("Tableau de contingence du nombre de doses de vaccins administrés en Belgique au", attr(vaccine, "local_save"), "en fonction du vaccin et de la dose administrée (A,B,C,..).")
  )
```

Les proportions des vaccins administrés par sexe sont proposées ci-dessous.

```{r}
vaccine %>.%
  sdrop_na(., sex) %>.%
  chart(data = .,  count ~ sex %fill=% brand) +
  geom_col(position = "fill") +
  coord_flip() +
  labs(caption = last_update, y = "Proportion des doses de vaccins administrés")
```

La Belgique a encouragé les Belges à se faire administrer des doses de booster nommées E, E1 et E2.

```{r}
# filtrer les données pour ne garder que les secondes doses et troisième dose de booster
vaccine %>.%
  sfilter(., dose %in% c("E2", "E3")) %>.%
  sgroup_by(., agegroup, region) %>.%
  ssummarise(., tot = fsum(count)) %>.%
  labelise(., label = list(
    tot = "Nombre de doses administrées"
  )) %->% comp_vaccine

comp_vaccine %>.%
  sdrop_na(., region) %>.%
  chart(., tot ~ agegroup %fill=% region) +
  geom_col() +
  labs(caption = last_update)
```

On dénombre `r sum(comp_vaccine$vac_tot)` doses de booster administrées. La répartition des groupes d'âge est disponible sur le graphique ci-dessous.

# Éléments clés

## Répartition des vaccins administrés

<!--% Proposez 3 éléments, sous forme de liste des résultats relatifs à la répartition régionale des vaccins administrés.-->

-   Le vaccin Pfizer-BioNTech est le plus employé dans chacune des régions de Belgique
-   ...
-   ...

## Vaccination par groupe d'âge

<!--% Proposez 2 éléments, sous forme de liste des résultats relatifs à la répartition régionale des vaccins administrés par groupe d'âge.-->
